<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Détails de l'enchère</title>
    <link rel="stylesheet" href="./css/style.css">
</head>
<body>
    <div class="page-container">
        <div th:replace="~{fragments/fragment-entete::entete}"></div>
        
        <main class="main-content">
            <div class="header-section">
                <h1>Détails de la vente</h1>
            </div>
            
            <form th:action="@{/encheresDetails}" th:object="${articleVendu}" method="post" class="filter-form">
                <div class="filter-section">
                    <div class="filter-options">
                        <div class="filter-group">
                            <div th:if="${!utilisateurIsAuthentificate}" class="form-group">
                                <label for="idArticle">Article :</label>
                                <textarea id="idArticle" th:text="${articleVendu.nomArticle}" readonly="readonly" class="form-control"></textarea>
                            </div>
                            <div th:if="${utilisateurIsAuthentificate}" class="form-group">
                                <label for="idArticle">Article :</label>
                                <textarea id="idArticle" th:field="*{nomArticle}" class="form-control"></textarea>
                            </div>

                            <div th:if="${!utilisateurIsAuthentificate}" class="form-group">
                                <label for="description">Description :</label>
                                <textarea id="description" th:text="${articleVendu.description}" readonly="readonly" class="form-control"></textarea>
                            </div>
                            <div th:if="${utilisateurIsAuthentificate}" class="form-group">
                                <label for="description">Description :</label>
                                <textarea th:field="*{description}" id="description" class="form-control"></textarea>
                            </div>
                        </div>

                        <div class="filter-group">
                            <div th:if="${!utilisateurIsAuthentificate}" class="form-group">
                                <label for="categorieArticle">Catégorie :</label>
                                <textarea id="categorieArticle" th:text="${articleVendu.categorieArticle.libelle}" readonly="readonly" class="form-control"></textarea>
                            </div>

                            <div th:if="${utilisateurIsAuthentificate}" class="form-group">
                                <label for="categorieArticle">Catégorie :</label>
                                <select th:field="*{categorieArticle.noCategorie}" class="form-control">
                                    <option th:each="c : ${listCategorie}" th:value="${c.noCategorie}" th:text="${c.libelle}"></option>
                                </select>
                            </div>

                            <div class="price-info">
                                <label for="montantEnchere">Meilleure offre :</label>
                                <div class="value">
                                    <span th:if="${articleVendu.listeEncheres!=null and not #lists.isEmpty(articleVendu.listeEncheres)}"
                                          th:text="${articleVendu.listeEncheres[0].montantEnchere}+' points par '+${articleVendu.listeEncheres[0].createur.pseudo}">
                                    </span>
                                    <span th:unless="${articleVendu.listeEncheres!=null and not #lists.isEmpty(articleVendu.listeEncheres)}">
                                        Vous êtes la première personne à Enchérir
                                    </span>
                                </div>
                            </div>
                        </div>

                        <div class="filter-group">
                            <div class="price-info">
                                <label for="miseAPrix">Mise à prix :</label>
                                <div th:if="${!utilisateurIsAuthentificate}" class="value" th:text="${articleVendu.miseAPrix}"></div>
                                <textarea th:if="${utilisateurIsAuthentificate}" id="miseAPrix" th:field="*{miseAPrix}" class="form-control"></textarea>
                            </div>

                            <div class="date-info">
                                <label for="dateFinEncheres">Fin de l'enchère :</label>
                                <div th:if="${!utilisateurIsAuthentificate}" class="value" th:text="${articleVendu.dateFinEncheres}"></div>
                                <textarea th:if="${utilisateurIsAuthentificate}" id="dateFinEncheres" th:field="*{dateFinEncheres}" class="form-control"></textarea>
                            </div>

                            <div class="date-info">
                                <label for="dateDebutEncheres">Début de l'enchère :</label>
                                <div th:if="${!utilisateurIsAuthentificate}" class="value" th:text="${articleVendu.dateDebutEncheres}"></div>
                                <textarea th:if="${utilisateurIsAuthentificate}" id="dateDebutEncheres" th:field="*{dateDebutEncheres}" class="form-control"></textarea>
                            </div>
                        </div>

                        <div class="filter-group">
                            <div th:if="${!utilisateurIsAuthentificate}" class="seller-info">
                                <label for="lieuRetrait">Retrait :</label>
                                <span class="value" th:text="${articleVendu.lieuRetrait.rue} +' '+ ${articleVendu.lieuRetrait.codePostal} +' ' +${articleVendu.lieuRetrait.ville}"></span>
                            </div>

                            <fieldset th:if="${utilisateurIsAuthentificate}" class="filter-section">
                                <legend>Retrait</legend>
                                <div class="filter-options">
                                    <div class="filter-group">
                                        <label for="rue">Rue :</label>
                                        <input id="rue" type="text" th:field="*{lieuRetrait.rue}" class="form-control">
                                    </div>
                                    <div class="filter-group">
                                        <label for="codePostal">Code postal :</label>
                                        <input id="codePostal" type="text" th:field="*{lieuRetrait.codePostal}" class="form-control">
                                    </div>
                                    <div class="filter-group">
                                        <label for="ville">Ville :</label>
                                        <input id="ville" type="text" th:field="*{lieuRetrait.ville}" class="form-control">
                                    </div>
                                </div>
                            </fieldset>

                            <div class="seller-info">
                                <label for="Createur">Créateur :</label>
                                <span class="value" th:text="${articleVendu.createur.pseudo}"></span>
                            </div>
                        </div>
                    </div>

                    <div class="card-image">
                        <img th:src="@{'/images/' + ${articleVendu.cheminImage}}" alt="Image de l'article">
                    </div>

                    <input type="hidden" th:field="*{noArticle}" />

                    <div th:if="${!utilisateurIsAuthentificate}" sec:authorize="isAuthenticated()" class="filter-section">
                        <h2>Montez les Enchères !</h2>
                        <div class="search-section">
                            <div class="search-group">
                                <input id="idProposition" name="proposition" placeholder="Faites vos jeux" th:value="${proposition}" class="form-control">
                            </div>
                        </div>
                    </div>

                    <div class="card-actions">
                        <button th:if="${utilisateurIsAuthentificate}" sec:authorize="isAuthenticated()" type="submit" class="view-details">
                            Modifier les informations
                        </button>
                        <button th:if="${!utilisateurIsAuthentificate}" sec:authorize="isAuthenticated()" type="submit" class="view-details">
                            Surenchérir
                        </button>
                    </div>
                </div>
            </form>
        </main>

        <div th:replace="~{fragments/fragment-piedpage::piedpage}"></div>
    </div>
</body>
</html>